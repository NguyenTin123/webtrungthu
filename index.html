<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday TTTA</title>
    <link rel="shortcut icon" type="image/png" href="birthdayCake.png"/>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Montserrat:wght@400;900&display=swap" rel="stylesheet">

    <style>
        :root { --vh: 1vh; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            height: calc(var(--vh) * 100);
            overflow: hidden;
            font-family: 'Montserrat', sans-serif;
            overscroll-behavior: none;
            -webkit-overflow-scrolling: auto;
        }
        body {
            position: fixed;
            inset: 0;
            width: 100%;
            touch-action: manipulation;
        }

        /* Reduce animations if user prefers */
        @media (prefers-reduced-motion: reduce) {
            * { animation: none !important; transition: none !important; scroll-behavior: auto !important; }
        }

        /* --- CONTAINER PH√ÅO HOA XUY√äN SU·ªêT --- */
        #fireworks-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 99999;
        }

        /* --- 1. M√ÄN H√åNH CH·ªú (ƒê√É TRANG TR√ç) --- */
        #screen-intro {
            position: fixed; inset: 0;
            background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%);
            z-index: 1000; display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
            border: 10px solid rgba(255, 255, 255, 0.3);
            box-shadow: inset 0 0 100px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .intro-balloon {
            position: absolute; bottom: -100px;
            width: 50px; height: 70px;
            border-radius: 50%; opacity: 0.8;
            z-index: 1; animation: floatUpIntro linear infinite;
        }
        @keyframes floatUpIntro {
            0% { transform: translateY(0) rotate(0deg); }
            100% { transform: translateY(-120vh) rotate(360deg); }
        }

        .intro-gift {
            font-size: 80px; margin-bottom: 20px;
            animation: giftShake 2s infinite ease-in-out;
            z-index: 5; filter: drop-shadow(0 10px 15px rgba(0,0,0,0.1));
        }
        @keyframes giftShake {
            0%, 100% { transform: rotate(0) scale(1); }
            25% { transform: rotate(-10deg) scale(1.1); }
            75% { transform: rotate(10deg) scale(1.1); }
        }

        #start-btn {
            padding: 20px 60px; font-size: 28px; color: white; background: #ff4757;
            border: 4px solid #fff; border-radius: 50px; cursor: pointer;
            box-shadow: 0 0 30px rgba(255, 71, 87, 0.6); animation: pulse 1.5s infinite;
            transition: all 0.3s ease; z-index: 10;
        }
        #start-btn:hover { transform: scale(1.1); background: #ff6b81; }

        /* --- 2. M√ÄN H√åNH ƒê·∫æM NG∆Ø·ª¢C --- */
        #screen-counter {
            display: none; height: calc(var(--vh) * 100); width: 100%;
            flex-direction: column;
            justify-content: center; align-items: center;
            background: radial-gradient(circle, #2d0b2e 0%, #000 100%);
            position: relative; overflow: hidden;
        }

        #screen-counter::before {
            content: ''; position: absolute; width: 200%; height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(255, 71, 87, 0.1), transparent 30%);
            animation: rotateGlow 8s linear infinite;
        }

        .sparkler-holder {
            position: absolute; bottom: 10%; width: 100%;
            display: flex; justify-content: space-around; pointer-events: none; z-index: 25;
        }
        .sparkler-stick {
            width: 6px; height: 200px; background: #444; border-radius: 10px; position: relative;
        }

        .sparkler-head {
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            width: 20px; height: 60px;
            background: linear-gradient(to bottom, #fff, #888, #444);
            border-radius: 10px;
            box-shadow: 0 0 20px #ffcc00, 0 0 40px #ffcc00;
        }

        .sparkler-burning { animation: burnDownEffect 15s linear forwards; }
        @keyframes burnDownEffect {
            0% { height: 60px; top: -10px; }
            100% { height: 0px; top: 50px; opacity: 0; }
        }

        .spark-particle {
            position: absolute; width: 4px; height: 4px; background: #ffcc00;
            border-radius: 50%; pointer-events: none;
        }

        .digit {
            font-size: 250px; font-weight: 900; color: #fff;
            text-shadow: 0 0 20px #ff4757, 0 0 40px #ff4757, 0 0 60px #ff4757;
            z-index: 20; transition: transform 0.2s;
            filter: drop-shadow(0 0 30px rgba(255, 71, 87, 0.8));
            position: relative;
        }

        .cake-wrapper {
            position: relative; font-size: 150px; margin-top: -30px; z-index: 20;
            animation: cakePulse 2s infinite ease-in-out;
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.4));
        }

        .flame {
            position: absolute; top: 15px; left: 50%; transform: translateX(-50%);
            width: 15px; height: 25px; background: #ff9d00;
            border-radius: 50% 50% 20% 20%;
            box-shadow: 0 0 15px #ff4757, 0 0 25px #ff9d00;
            animation: flicker 0.1s infinite alternate;
        }

        .glow-ring {
            position: absolute; width: 500px; height: 500px; border-radius: 50%;
            border: 2px solid rgba(255, 71, 87, 0.2);
            box-shadow: inset 0 0 50px rgba(255, 71, 87, 0.2), 0 0 50px rgba(255, 71, 87, 0.2);
            animation: rotateRing 15s linear infinite; z-index: 5;
        }
        .glow-ring:nth-child(2) { width: 450px; height: 450px; animation-direction: reverse; border-style: dashed; }

        .magic-dust { position: absolute; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .dust { position: absolute; background: white; border-radius: 50%; filter: blur(1px); animation: floatParticle linear infinite; }

        /* --- 3. CHU·ªñI CH·ªÆ CH√öC M·ª™NG --- */
        #hb-container {
            display: none; position: fixed; inset: 0;
            z-index: 9999; background: rgba(255, 182, 193, 0.8); backdrop-filter: blur(10px);
            justify-content: center; align-items: center; transition: opacity 1s;
        }

        .birthday-card {
            background: white; padding: 40px 60px; border-radius: 30px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15); border: 10px solid #fff;
            outline: 2px dashed #ff4757; outline-offset: -15px;
            text-align: center; max-width: 90%; position: relative;
            animation: cardPop 1s cubic-bezier(0.17, 0.89, 0.32, 1.49);
            overflow: visible;
        }

        .meaningful-text {
            font-family: 'Dancing Script', cursive;
            color: #8b4513;
            font-size: 1.4rem;
            font-weight: bold;
            line-height: 1.4;
            margin: 25px auto;
            padding: 15px;
            max-width: 85%;
            text-shadow: 1px 1px 0px #fff, 1px 1px 5px rgba(0,0,0,0.1);
            border-top: 2px solid rgba(184, 134, 11, 0.3);
            border-bottom: 2px solid rgba(184, 134, 11, 0.3);
            position: relative;
            min-height: 150px;
        }

        .meaningful-text::before {
            content: '‚ù¶';
            display: block;
            color: #b8860b;
            font-size: 1.8rem;
            margin: 5px 0;
        }
        .meaningful-text.caret::after {
            content: '|';
            position: absolute;
            right: 12px;
            bottom: 12px;
            animation: blink 1s infinite;
            color: rgba(139, 69, 19, 0.8);
        }
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .flower-orbit {
            position: absolute;
            top: -20px; left: -20px; right: -20px; bottom: -20px;
            pointer-events: none; z-index: 15;
        }

        .orbit-flower {
            position: absolute;
            font-size: 24px;
            offset-path: rect(0% 100% 100% 0% round 30px);
            animation: orbitMove 18s linear infinite;
        }

        @keyframes orbitMove {
            0% { offset-distance: 0%; transform: rotate(0deg); }
            100% { offset-distance: 100%; transform: rotate(360deg); }
        }

        .card-flower {
            position: absolute; font-size: 60px; z-index: 10;
            filter: drop-shadow(2px 2px 5px rgba(0,0,0,0.2));
            animation: flowerSway 3s ease-in-out infinite;
        }
        .f-top-left { top: -45px; left: -45px; }
        .f-top-right { top: -45px; right: -45px; animation-delay: 0.5s; }
        .f-bottom-left { bottom: -45px; left: -45px; animation-delay: 1s; }
        .f-bottom-right { bottom: -45px; right: -45px; animation-delay: 1.5s; }

        @keyframes flowerSway {
            0%, 100% { transform: rotate(-10deg) scale(1); }
            50% { transform: rotate(10deg) scale(1.1); }
        }

        .hb-line {
            font-family: 'Dancing Script', cursive;
            background: linear-gradient(to right, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #8b00ff);
            -webkit-background-clip: text; color: transparent;
            background-size: 200% auto; animation: rainbow 3s linear infinite;
            margin-bottom: 10px; opacity: 0;
        }
        #line1 { font-size: 4.5vw; animation: popIn 0.8s forwards; }
        #line2, #line3 {
            font-size: 2.2vw; animation: slideUp 0.8s forwards 0.8s;
            color: #ff4757; -webkit-text-fill-color: initial; background: none;
        }

        /* --- 4. TRANG CH√çNH --- */
        #screen-main {
            display: none; height: calc(var(--vh) * 100); width: 100%;
            background: radial-gradient(circle, #fff0f3 0%, #ffdde1 100%);
            position: relative; overflow: hidden;
        }

        .balloon-row { display: flex; justify-content: center; gap: 10px; position: absolute; top: 5%; width: 100%; z-index: 30; }
        .letter-balloon {
            width: 60px; height: 75px; background: #ff4757;
            border-radius: 50% 50% 50% 50% / 40% 40% 60% 60%;
            display: flex; justify-content: center; align-items: center;
            color: white; font-size: 28px; font-weight: 900;
            box-shadow: inset -5px -5px 15px rgba(0,0,0,0.1);
            position: relative; animation: swayBalloon 3s ease-in-out infinite;
        }

        .photo-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 50px; z-index: 20; }

        .avatar__img {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 6px solid #fff;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            object-fit: cover;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
        }
        .avatar__img:hover {
            transform: scale(1.2) rotate(5deg);
            z-index: 100;
            box-shadow: 0 15px 35px rgba(255, 71, 87, 0.4);
            border-color: #ff4757;
        }
        .avatar__title { margin-top: 30px; font-family: 'Dancing Script', cursive; font-size: 4rem; color: #ff4757; text-shadow: 2px 2px 0px #fff; text-align: center; z-index: 20; }

        .falling-photo {
            position: absolute;
            top: -200px;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 5px solid white;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            object-fit: cover;
            pointer-events: none;
            z-index: 10;
            animation: fallPhoto linear forwards;
        }
        @keyframes fallPhoto { to { transform: translateY(120vh) rotate(360deg); } }

        /* Keyframes chung */
        @keyframes rotateGlow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes rotateRing { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes cakePulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes floatParticle { 0% { transform: translateY(100vh) scale(0); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateY(-10vh) scale(1.2); opacity: 0; } }
        @keyframes cardPop { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes flicker { 0% { transform: translateX(-50%) scale(1); opacity: 0.9; } 100% { transform: translateX(-50%) scale(1.1) rotate(2deg); opacity: 1; } }
        @keyframes swayBalloon { 0%, 100% { transform: translateY(0) rotate(-5deg); } 50% { transform: translateY(-15px) rotate(5deg); } }
        @keyframes rainbow { 0% { background-position: 0% 50%; } 100% { background-position: 200% 50%; } }
        @keyframes popIn { 0% { transform: scale(0); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes slideUp { 0% { transform: translateY(30px); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
        @keyframes pulse { 0%, 100% {transform: scale(1);} 50% {transform: scale(1.1);} }

        .petal { position: absolute; top: -10%; user-select: none; pointer-events: none; z-index: 50; animation: fall linear infinite, sway ease-in-out infinite; }
        @keyframes fall { to { top: 110%; } }
        @keyframes sway { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(100px); } }

        /* --- CSS TRANG TR√ç THI·ªÜP M·ªúI --- */
        .invitation-card-custom {
            background: #fffaf0 !important;
            border: 15px solid transparent !important;
            border-image: url('https://www.transparenttextures.com/patterns/gold-dust.png') 30 round;
            outline: 2px solid #b8860b;
            outline-offset: -10px;
            border-radius: 5px !important;
            box-shadow: 0 0 40px rgba(0,0,0,0.3), inset 0 0 100px rgba(184, 134, 11, 0.1) !important;
        }

        .invitation-header {
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            letter-spacing: 3px;
            color: #8b4513;
            text-transform: uppercase;
            font-size: 0.8rem;
            margin-bottom: 10px;
            border-bottom: 1px solid #b8860b;
            display: inline-block;
            padding-bottom: 5px;
        }

        .swal-img-polaroid {
            background: white;
            padding: 10px 10px 25px 10px;
            border: 1px solid #ddd;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.2);
            transform: rotate(-3deg);
            margin: 15px 0;
            display: inline-block;
        }

        /* Hint click */
        .click-hint {
            font-family: 'Montserrat', sans-serif;
            font-size: 0.8rem;
            color: #b8860b;
            margin-top: 10px;
            display: block;
            animation: blinkHint 1.5s infinite;
        }
        @keyframes blinkHint {
            0% { opacity: 0.3; }
            50% { opacity: 1; }
            100% { opacity: 0.3; }
        }

        /* ·∫¢nh k·ªâ ni·ªám bay l∆° l·ª≠ng khi m·ªü qu√† */
        .floating-photo-surprise {
            position: fixed;
            width: 100px; height: 100px;
            object-fit: cover;
            border: 4px solid white;
            box-shadow: 0 8px 20px rgba(0,0,0,0.6);
            z-index: 1000002;
            pointer-events: none;
            animation: float-up-fade 8s ease-in forwards;
            opacity: 0;
        }
        @keyframes float-up-fade {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-120vh) rotate(20deg); opacity: 0; }
        }

        .soft-glow-text {
            font-family: 'Dancing Script', cursive;
            color: #fff;
            text-shadow: 0 0 20px rgba(255, 215, 0, 1), 0 0 30px rgba(255, 64, 129, 0.8);
            text-align: center;
            z-index: 1000003;
            pointer-events: none;
            line-height: 1.4;
        }

        /* ================== NEW YEAR SCREEN ================== */
        #screen-newyear {
            display: none;
            position: fixed;
            inset: 0;
            background: linear-gradient(to bottom, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            z-index: 100000;
            justify-content: center;
            align-items: center;
            text-align: center;
            overflow: hidden;
        }

        #screen-newyear::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image:
                radial-gradient(3px 3px at 50px 50px, #fff, transparent),
                radial-gradient(2px 2px at 150px 100px, #ffd700, transparent),
                radial-gradient(3px 3px at 250px 150px, #fff, transparent),
                radial-gradient(2px 2px at 350px 200px, #ffd700, transparent),
                radial-gradient(20px 25px at 200px 300px, rgba(255, 215, 0, 0.15), transparent);
            background-repeat: repeat;
            background-size: 400px 400px;
            animation: twinkle 8s infinite ease-in-out;
            opacity: 0.5;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.7; transform: translateY(0) rotate(0deg); }
            25% { opacity: 1; transform: translateY(-5px) rotate(90deg); }
            50% { opacity: 0.8; transform: translateY(-10px) rotate(180deg); }
            75% { opacity: 0.9; transform: translateY(-5px) rotate(270deg); }
        }

        .ny-content { color: white; animation: popIn 1s ease; position: relative; z-index: 2; padding: 0 14px; }

        .ny-title {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(2rem, 8vw, 4rem);
            background: linear-gradient(45deg, #ffd700, #ff4757, #ffffff, #ffd700, #00ff00, #0000ff, #ff1493);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow:
                0 0 5px #ffd700,
                0 0 10px #ff4757,
                0 0 15px #ffffff,
                0 0 20px rgba(255, 215, 0, 0.8),
                0 0 35px rgba(255, 71, 87, 0.6),
                0 0 40px rgba(255, 255, 255, 0.4);
            -webkit-text-stroke: 1px rgba(255, 215, 0, 0.5);
            text-stroke: 1px rgba(255, 215, 0, 0.5);
            animation: titleGlow 3s infinite ease-in-out, rainbowShift 5s infinite linear;
            position: relative;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.3));
        }

        @keyframes titleGlow {
            0%, 100% {
                text-shadow:
                    0 0 5px #ffd700,
                    0 0 10px #ff4757,
                    0 0 15px #ffffff,
                    0 0 20px rgba(255, 215, 0, 0.8),
                    0 0 35px rgba(255, 71, 87, 0.6),
                    0 0 40px rgba(255, 255, 255, 0.4);
            }
            50% {
                text-shadow:
                    0 0 10px #ff4757,
                    0 0 20px #ffd700,
                    0 0 30px #ffffff,
                    0 0 40px rgba(255, 71, 87, 0.9),
                    0 0 60px rgba(255, 215, 0, 0.7),
                    0 0 80px rgba(255, 255, 255, 0.5);
            }
        }

        @keyframes rainbowShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .ny-text {
            margin: 18px auto;
            font-size: clamp(0.85rem, 3.2vw, 1.5rem);
            line-height: 1.5;
            color: #ffffff;
            background: linear-gradient(90deg, #ffd700, #ff4757, #ffffff, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow:
                0 0 5px rgba(255, 215, 0, 0.8),
                0 0 10px rgba(255, 71, 87, 0.6),
                0 0 15px rgba(255, 255, 255, 0.4);
            font-weight: 500;
            animation: textFadeIn 2s ease-in-out, textGlow 4s infinite ease-in-out;
            position: relative;
            -webkit-text-stroke: 0.5px rgba(255, 215, 0, 0.3);
            text-stroke: 0.5px rgba(255, 215, 0, 0.3);
            max-width: 900px;
        }

        .ny-text b {
            color: #ffd700;
            font-weight: bold;
            text-shadow: 0 0 10px #ffd700, 0 0 20px #ffd700, 0 0 30px #ffd700;
            -webkit-text-stroke: 1px rgba(255, 215, 0, 0.5);
            text-stroke: 1px rgba(255, 215, 0, 0.5);
        }

        @keyframes textFadeIn {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        @keyframes textGlow {
            0%, 100% { text-shadow: 0 0 5px rgba(255, 215, 0, 0.8), 0 0 10px rgba(255, 71, 87, 0.6), 0 0 15px rgba(255, 255, 255, 0.4); }
            50% { text-shadow: 0 0 10px rgba(255, 71, 87, 0.9), 0 0 20px rgba(255, 215, 0, 0.7), 0 0 25px rgba(255, 255, 255, 0.5); }
        }

        #btn-to-main {
            padding: 15px 50px;
            font-size: 1.3rem;
            border-radius: 40px;
            border: none;
            cursor: pointer;
            background: gold;
            color: #000;
            animation: pulse 1.5s infinite;
        }

        /* ================== GO TO NEW YEAR ================== */
        #go-newyear {
            position: fixed;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.1rem;
            font-family: 'Montserrat', sans-serif;
            color: gold;
            cursor: pointer;
            opacity: 0;
            z-index: 999999;
            animation: blinkNY 1.8s infinite;
            transition: opacity 1s, transform 0.3s;
        }

        #go-newyear:hover {
            transform: translateX(-50%) scale(1.1);
            text-shadow: 0 0 10px gold;
        }

        @keyframes blinkNY {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }

        /* ================== THANK YOU SCREEN ================== */
        #screen-thankyou {
            display: none;
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 50%, #ff6b6b 100%),
                        radial-gradient(circle at 20% 80%, rgba(255, 215, 0, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255, 0, 0, 0.2) 0%, transparent 50%),
                        radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 40%),
                        url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48cmFkaWFsR3JhZGllbnQgaWQ9ImEiIGN4PSI1MCUiIGN5PSI1MCUiIHI9IjUwJSI+PHN0b3Agb2Zmc2V0PSIwIiBzdG9wLWNvbG9yPSIjZmZkNzAwIiBzdG9wLW9wYWNpdHk9IjAuNSIvPjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iI2ZmZmZmZmIiBzdG9wLW9wYWNpdHk9IjAiLz48L3JhZGlhbEdyYWRpZW50PjwvZGVmcz48Y2lyY2xlIGN4PSI1MCUiIGN5PSI1MCUiIHI9IjUwJSIgZmlsbD0idXJsKCNhKSIvPjwvc3ZnPg==') repeat;
            background-size: 100% 100%, 300px 300px, 250px 250px, 400px 400px, 150px 150px;
            z-index: 100001;
            justify-content: center;
            align-items: center;
            text-align: center;
            overflow: hidden;
        }

        #screen-thankyou::after {
            content: '';
            position: absolute;
            inset: 0;
            background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48cmFkaWFsR3JhZGllbnQgaWQ9ImEiIGN4PSI1MCUiIGN5PSI1MCUiIHI9IjUwJSI+PHN0b3Agb2Zmc2V0PSIwIiBzdG9wLWNvbG9yPSIjZmZkNzAwIiBzdG9wLW9wYWNpdHk9IjAuNSIvPjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iI2ZmZmZmZmIiBzdG9wLW9wYWNpdHk9IjAiLz48L3JhZGlhbEdyYWRpZW50PjwvZGVmcz48Y2lyY2xlIGN4PSI1MCUiIGN5PSI1MCUiIHI9IjUwJSIgZmlsbD0idXJsKCNhKSIvPjwvc3ZnPg==') repeat;
            background-size: 100px 100px;
            animation: sparkleBackground 15s linear infinite;
            opacity: 0.1;
            pointer-events: none;
        }

        @keyframes sparkleBackground {
            0% { background-position: 0 0; }
            100% { background-position: 100px 100px; }
        }

        .thankyou-content { color: #2d3436; animation: popIn 1s ease; position: relative; z-index: 2; padding: 0 14px; }
        .thankyou-title { font-family: 'Dancing Script', cursive; font-size: 3rem; margin-bottom: 20px; text-shadow: 2px 2px 0px #fff; }
        .thankyou-text { font-family: 'Montserrat', sans-serif; font-size: 1.5rem; margin-bottom: 30px; line-height: 1.6; }
        .thankyou-emojis { font-size: 2rem; }

        /* ================== RESPONSIVE ================== */
        @media (max-width: 768px) {
            .digit { font-size: 120px; }
            .cake-wrapper { font-size: 80px; }
            .letter-balloon { width: 40px; height: 50px; font-size: 16px; }
            .avatar__img { width: 200px; height: 200px; }
            .avatar__title { font-size: 3rem; }
            #line1 { font-size: 6vw; }
            #line2, #line3 { font-size: 3.5vw; }
            .meaningful-text { font-size: 1.2rem; max-width: 95%; padding: 12px; }
            .glow-ring { width: 350px; height: 350px; }
            .card-flower { font-size: 50px; }
            .ny-title { font-size: clamp(2rem, 8vw, 3rem); }
            .ny-text { font-size: clamp(0.85rem, 3.4vw, 1.25rem); }
            #btn-to-main { padding: 12px 40px; font-size: 1.1rem; }
            .photo-grid { grid-template-columns: repeat(2, 1fr); gap: 15px; }
        }

        @media (max-width: 600px) {
            .digit { font-size: 100px; }
            .cake-wrapper { font-size: 60px; }
            .letter-balloon { width: 30px; height: 40px; font-size: 12px; }
            .avatar__img { width: 130px; height: 130px; }
            .avatar__title { font-size: 2rem; }
            #line1 { font-size: 7vw; }
            #line2, #line3 { font-size: 4vw; }
            .meaningful-text { font-size: 1rem; max-width: 95%; padding: 10px; }
            .glow-ring { width: 250px; height: 250px; }
            .card-flower { font-size: 40px; }
            .thankyou-title { font-size: 2.3rem; }
            .thankyou-text { font-size: 1.1rem; }
            .photo-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
            .balloon-row { top: 2%; }
            .intro-gift { font-size: 60px; }
            #start-btn { padding: 15px 40px; font-size: 24px; }
            .birthday-card { padding: 30px 40px; }
            .floating-photo-surprise { width: 80px; height: 80px; }
            .falling-photo { width: 110px; height: 110px; }
        }

        @media (max-width: 480px) {
            .digit { font-size: 80px; }
            .cake-wrapper { font-size: 50px; }
            .thankyou-title { font-size: 2rem; }
            .thankyou-text { font-size: 1rem; }
            #start-btn { padding: 12px 30px; font-size: 20px; }
            .birthday-card { padding: 25px 30px; }
            .meaningful-text { font-size: 0.9rem; }
        }

        @media (max-width: 360px) {
            .digit { font-size: 60px; }
            .cake-wrapper { font-size: 40px; }
            .avatar__title { font-size: 1.5rem; }
            .meaningful-text { font-size: 0.8rem; min-height: 120px; }
            .letter-balloon { width: 25px; height: 30px; font-size: 10px; }
            .avatar__img { width: 130px; height: 130px; }
            .glow-ring { width: 200px; height: 200px; }
            .sparkler-stick { height: 150px; }
            .falling-photo { width: 90px; height: 90px; }
            .floating-photo-surprise { width: 60px; height: 60px; }
        }
    </style>
</head>
<body>
    <div id="fireworks-container"></div>

    <div id="screen-intro">
        <div id="intro-balloons-container"></div>
        <div class="intro-gift">üéÅ</div>
        <h1 style="color: white; margin-bottom: 30px; padding: 0 20px; z-index: 10; text-shadow: 2px 2px 15px rgba(0,0,0,0.2);">
            üå∏ M√ìN QU√Ä SINH NH·∫¨T D√ÄNH CHO THU√ù ANHüå∏<br>
            <span style="font-size: 0.5em; font-weight: 400; opacity: 0.9;">(ADMIN AT TR·∫¶N)</span>
        </h1>
        <button id="start-btn">C√ôNG NHAU KH√ÅM PH√Å M√ìN QU√Ä SINH NH·∫¨T üéÅ</button>
        <p style="margin-top: 20px; color: white; font-style: italic; opacity: 0.7; z-index: 10;">A special surprise is waiting for you...</p>
    </div>

    <div id="screen-counter">
        <div class="glow-ring"></div>
        <div class="glow-ring"></div>
        <div class="magic-dust" id="magic-dust"></div>

        <div class="sparkler-holder">
            <div class="sparkler-stick" id="stick-1"><div class="sparkler-head"></div></div>
            <div class="sparkler-stick" id="stick-2"><div class="sparkler-head"></div></div>
        </div>

        <div id="digit" class="digit">15</div>
        <div class="cake-wrapper">
            <div class="flame"></div>
            üéÇ
        </div>
    </div>

    <div id="hb-container">
        <div class="birthday-card">
            <div class="flower-orbit" id="orbit-container"></div>

            <div class="card-flower f-top-left">üå∏</div>
            <div class="card-flower f-top-right">üå∫</div>
            <div class="card-flower f-bottom-left">üåª</div>
            <div class="card-flower f-bottom-right">üåπ</div>

            <h1 id="line1" class="hb-line">Happy Birthday Thu√Ω Anh ( TTTA - AT Tr·∫ßn)!</h1>
            <h2 id="line2" class="hb-line">‚ú® 31-1-2026 ‚ú®</h2>

            <div class="meaningful-text caret" id="typewriter-text"></div>

            <h2 id="line3" class="hb-line">29-12 √Çm l·ªãch Ng√†y T√¢n D·∫≠u th√°ng K·ª∑ S·ª≠u nƒÉm ·∫§t T·ªµ</h2>
            <div style="font-size: 30px; margin-top: 20px;">‚ù§Ô∏èüíñüå∑üåºüíïüéÇüå∏üå∫üíùüíó</div>
        </div>
    </div>

    <!-- ================== NEW YEAR SCREEN ================== -->
    <div id="screen-newyear">
        <div class="ny-content">
            <h1 class="ny-title"></h1>
            <p class="ny-text"></p>
            <button id="btn-to-main">Ti·∫øp t·ª•c üéÅ</button>
        </div>
    </div>

    <!-- ================== THANK YOU SCREEN ================== -->
    <div id="screen-thankyou">
        <div class="thankyou-content">
            <h1 class="thankyou-title"></h1>
            <p class="thankyou-text"></p>
            <div class="thankyou-emojis">üå∏üéÇüíñüåºüéÅ‚ú®</div>
        </div>
    </div>

    <div id="screen-main">
        <div id="go-newyear">‚ú® B·∫°n ƒë√£ thu nh·∫≠p ƒë·ªß 6 l·ªùi ch√∫c. B·∫•m v√†o ƒë·ªÉ xem m√≥n qu√† th·ª© 2‚ù§Ô∏è üéÜ</div>
        <div class="balloon-row" id="balloon-row"></div>
        <div class="container" style="height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center;">
            <div class="photo-grid">
                <img src="a1.jpg" class="avatar__img" alt="">
                <img src="a40.jpg" class="avatar__img" alt="">
                <img src="a33.png" class="avatar__img" alt="">
                <img src="a25.jpg" class="avatar__img" alt="">
                <img src="a23.jpg" class="avatar__img" alt="">
                <img src="a41.png" class="avatar__img" alt="">
            </div>
            <h1 class="avatar__title">TR·∫¶N TH·ªä THU√ù ANH ( AT TR·∫¶N)‚ù§Ô∏è</h1>
        </div>
    </div>

    <audio id="player" loop preload="auto">
        <!-- B·∫°n t·ª± th√™m nh·∫°c n·∫øu c·∫ßn -->
        <!-- <source src="sn.mp3" type="audio/mp3"> -->
    </audio>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fireworks-js@2.x/dist/index.umd.js"></script>

    <script>
        // ========= Mobile viewport fix (prevents "jumping" on phones) =========
        function setVh() {
            const vh = (window.visualViewport ? window.visualViewport.height : window.innerHeight) * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }
        setVh();
        window.addEventListener('resize', setVh, { passive: true });
        window.addEventListener('orientationchange', setVh, { passive: true });
        if (window.visualViewport) {
            window.visualViewport.addEventListener('resize', setVh, { passive: true });
        }

        // ========= Helpers =========
        const $ = (sel) => document.querySelector(sel);
        const $$ = (sel) => Array.from(document.querySelectorAll(sel));

        const isMobile = window.matchMedia('(max-width: 600px)').matches;
        const clickedPhotos = new Set();
        const TOTAL_PHOTOS_REQUIRED = 6;

        // ========= Typewriter (reuse) =========
        function typeWriter(el, text, speed, done) {
            if (!el) return;
            let i = 0;
            el.innerHTML = '';
            function tick() {
                if (i >= text.length) return done && done();
                const ch = text.charAt(i++);
                el.innerHTML += (ch === '\n') ? '<br>' : ch;
                setTimeout(tick, speed);
            }
            tick();
        }

        // ========= Intro balloons =========
        function initIntroBalloons() {
            const container = document.getElementById('intro-balloons-container');
            if (!container) return;
            const colors = ['#ff4757', '#ffa502', '#2ed573', '#1e90ff', '#3742fa', '#ffffff'];
            for (let i = 0; i < 15; i++) {
                const b = document.createElement('div');
                b.className = 'intro-balloon';
                b.style.left = Math.random() * 100 + "vw";
                b.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                b.style.animationDuration = (Math.random() * 5 + 6) + "s";
                b.style.animationDelay = Math.random() * 5 + "s";
                b.style.width = (Math.random() * 30 + 20) + "px";
                b.style.height = (parseFloat(b.style.width) * 1.3) + "px";
                container.appendChild(b);
            }
        }

        // ========= Orbit flowers =========
        function initOrbitFlowers() {
            const container = document.getElementById('orbit-container');
            if (!container) return;
            const items = ['üå∏', 'üéÇ', '‚ù§Ô∏è', 'üåº', 'üíñ', 'üåª', 'üíù', 'üå∫', 'üíï', 'üåπ', 'üíó', 'üå∑'];
            const total = 50;
            const dur = 18;
            for (let i = 0; i < total; i++) {
                const el = document.createElement('div');
                el.className = 'orbit-flower';
                el.innerText = items[i % items.length];
                el.style.animationDelay = `${-(dur / total) * i}s`;
                container.appendChild(el);
            }
        }

        // ========= Background effects =========
        function createPetals() {
            const flowers = ['üå∏', 'üéÇ', '‚ù§Ô∏è', 'üåº', 'üíñ', 'üåª', 'üíù', 'üå∫', 'üíï', 'üåπ', 'üíó', 'üå∑'];
            const count = isMobile ? 28 : 50;
            for (let i = 0; i < count; i++) {
                const p = document.createElement("div");
                p.className = "petal";
                p.innerText = flowers[Math.floor(Math.random() * flowers.length)];
                p.style.left = Math.random() * 100 + "vw";
                p.style.animationDuration = (Math.random() * 5 + 5) + "s";
                p.style.animationDelay = Math.random() * 5 + "s";
                document.body.appendChild(p);
            }
        }

        function createMagicDust() {
            const dustContainer = document.getElementById('magic-dust');
            if (!dustContainer) return;
            const count = isMobile ? 70 : 120;
            for (let i = 0; i < count; i++) {
                const d = document.createElement("div");
                d.className = "dust";
                const size = (Math.random() * 4 + 2) + "px";
                d.style.width = size; d.style.height = size;
                d.style.left = Math.random() * 100 + "vw";
                d.style.top = Math.random() * 100 + "vh";
                d.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 80%)`;
                d.style.animationDuration = (Math.random() * 3 + 2) + "s";
                d.style.animationDelay = (Math.random() * 5) + "s";
                dustContainer.appendChild(d);
            }
        }

        // ========= Music autoplay on first click =========
        const music = document.getElementById('player');
        let musicStarted = false;
        function handleGlobalClick() {
            if (musicStarted || !music) return;
            music.play().then(() => { musicStarted = true; }).catch(() => {});
        }

        // ========= Confetti continuous (throttled) =========
        let confettiTimer = null;
        function startContinuousConfetti() {
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 99999 };
            const intervalMs = isMobile ? 450 : 220; // gi·∫£m tr√™n mobile
            function randomInRange(min, max) { return Math.random() * (max - min) + min; }
            confettiTimer = setInterval(() => {
                confetti(Object.assign({}, defaults, {
                    particleCount: isMobile ? 22 : 40,
                    origin: { x: randomInRange(0.1, 0.9), y: randomInRange(0.1, 0.5) }
                }));
            }, intervalMs);
        }

        // ========= Fireworks-js (keep) =========
        let fireworksInstance = null;
        let fireworksSparkInterval = null;
        function startUpwardFireworks() {
            const container = document.getElementById('fireworks-container');
            if (!container || typeof Fireworks === 'undefined') return;

            // Prevent duplicates
            stopUpwardFireworks();

            fireworksInstance = new Fireworks.default(container, {
                autoresize: true,
                opacity: 0.5,
                acceleration: 1.05,
                friction: 0.97,
                gravity: 1.5,
                particles: isMobile ? 90 : 150,
                traceLength: 3,
                traceSpeed: 10,
                explosion: 6,
                intensity: isMobile ? 18 : 30,
                ficker: true,
                lineStyle: 'round',
                hue: { min: 0, max: 360 },
                delay: { min: 30, max: 60 },
                rocketsPoint: { min: 50, max: 50 },
                lineWidth: {
                    explosion: { min: 1, max: 3 },
                    trace: { min: 1, max: 2 }
                },
                brightness: { min: 50, max: 80 },
                decay: { min: 0.015, max: 0.03 }
            });

            fireworksInstance.start();

            // Spark edges (throttled)
            const intervalMs = isMobile ? 900 : 500;
            fireworksSparkInterval = setInterval(() => {
                const sparkConfig = {
                    particleCount: isMobile ? 8 : 12,
                    startVelocity: 60,
                    spread: 15,
                    ticks: 120,
                    scale: 0.8,
                    shapes: ['circle'],
                    colors: ['#FFE45E', '#FFB200', '#FFFFFF', '#FF7400'],
                    gravity: 1.2,
                    scalar: 0.7,
                    zIndex: 99999
                };
                confetti({ ...sparkConfig, origin: { x: 0.1, y: 1 }, angle: 80 });
                confetti({ ...sparkConfig, origin: { x: 0.9, y: 1 }, angle: 100 });
            }, intervalMs);
        }

        function stopUpwardFireworks() {
            if (fireworksSparkInterval) {
                clearInterval(fireworksSparkInterval);
                fireworksSparkInterval = null;
            }
            if (fireworksInstance && typeof fireworksInstance.stop === 'function') {
                fireworksInstance.stop();
            }
            fireworksInstance = null;
        }

        // ========= Counter sparks =========
        function createSparkles(stickId) {
            const stick = document.getElementById(stickId);
            if (!stick) return;
            const head = stick.querySelector('.sparkler-head');
            if (!head) return;

            const currentHeadTop = head.offsetTop;
            for (let i = 0; i < (isMobile ? 5 : 8); i++) {
                const p = document.createElement('div');
                p.className = 'spark-particle';
                p.style.left = '50%';
                p.style.top = currentHeadTop + 'px';
                const vx = (Math.random() - 0.5) * 150;
                const vy = (Math.random() - 0.5) * 150 - 50;
                stick.appendChild(p);
                p.animate([
                    { transform: 'translate(0,0) scale(1)', opacity: 1 },
                    { transform: `translate(${vx}px, ${vy}px) scale(0)`, opacity: 0 }
                ], {
                    duration: 400 + Math.random() * 400,
                    easing: 'ease-out'
                }).onfinish = () => p.remove();
            }
        }

        // ========= Main balloons =========
        function initBalloons() {
            const row = document.getElementById('balloon-row');
            if (!row) return;
            const text = "HAPPYBIRTHDAY";
            const colors = ['#ff4757', '#ffa502', '#2ed573', '#1e90ff', '#3742fa', '#ff6b81'];
            row.innerHTML = '';
            text.split('').forEach((char, i) => {
                const b = document.createElement('div');
                b.className = 'letter-balloon';
                b.innerText = char;
                b.style.backgroundColor = colors[i % colors.length];
                b.style.animationDelay = (i * 0.2) + "s";
                row.appendChild(b);
            });
        }

        // ========= Falling photos =========
        const photoSourcesAll = [
            "a1.jpg","a2.png","a3.png","a4.png","a5.jpg","a6.jpg","a7.jpg","a8.jpg","a9.png","a10.jpg",
            "a11.jpg","a12.jpg","a13.png","a14.jpg","a15.png","a16.png","a17.png","a18.png","a19.png","a20.png",
            "a21.png","a22.jpg","a23.jpg","a24.jpg","a25.jpg","a26.jpg","a27.jpg","a28.png","a29.png","a30.png",
            "a31.png","a32.png","a33.png","a34.png","a35.png","a36.png","a37.jpg","a38.jpg","a39.jpg","a40.jpg",
            "a41.png","a42.png","a43.png","a44.png","a45.png","a46.png","a47.png","a48.png","a49.png","a50.png","a51.png"
        ];

        let fallingTimer = null;
        function startFallingPhotos() {
            const intervalMs = isMobile ? 1400 : 1000;
            fallingTimer = setInterval(() => {
                const img = document.createElement('img');
                img.src = photoSourcesAll[Math.floor(Math.random() * photoSourcesAll.length)];
                img.className = 'falling-photo';
                img.style.left = Math.random() * 90 + "vw";
                const duration = Math.random() * 4 + 4;
                img.style.animationDuration = duration + "s";
                document.body.appendChild(img);
                setTimeout(() => img.remove(), duration * 1000);
            }, intervalMs);
        }

        // ========= Data =========
        const heartColors = [
            'hsl(0, 100%, 70%)',
            'hsl(60, 100%, 70%)',
            'hsl(120, 100%, 70%)',
            'hsl(180, 100%, 70%)',
            'hsl(240, 100%, 70%)',
            'hsl(300, 100%, 70%)'
        ];

        const birthdayData = [
            { wish: "Ch√∫c Thu√Ω Anh tu·ªïi m·ªõi r·∫°ng r·ª° nh∆∞ √°nh m·∫∑t tr·ªùi! ‚òÄÔ∏è", img: "a1.jpg",
              finalWish: "H√£y lu√¥n t·ªèa s√°ng, ·∫•m √°p v√† lan t·ªèa nƒÉng l∆∞·ª£ng t√≠ch c·ª±c ƒë·∫øn m·ªçi ng∆∞·ªùi xung quanh nh√©!"
            },
            { wish: "Ch√∫c Thu√Ω Anh lu√¥n xinh ƒë·∫πp, h·∫°nh ph√∫c b√™n gia ƒë√¨nh! üå∏", img: "a40.jpg",
              finalWish: "Mong r·∫±ng m·ªói ng√†y tr√¥i qua ƒë·ªÅu ng·∫≠p tr√†n y√™u th∆∞∆°ng v√† nh·ªØng kho·∫£nh kh·∫Øc b√¨nh y√™n."
            },
            { wish: "Mong Thu√Ω Anh lu√¥n g·∫∑p may m·∫Øn trong cu·ªôc s·ªëng! üçÄ", img: "a33.png",
              finalWish: "D√π ƒëi ƒë·∫øn ƒë√¢u hay l√†m ƒëi·ªÅu g√¨, c≈©ng lu√¥n c√≥ nh·ªØng ƒëi·ªÅu t·ªët ƒë·∫πp ch·ªù ƒë√≥n ph√≠a tr∆∞·ªõc."
            },
            { wish: "Ch√∫c Thu√Ω Anh tu·ªïi m·ªõi ƒë·∫°t ƒë∆∞·ª£c m·ªçi ∆∞·ªõc m∆° mong mu·ªën! ‚ú®", img: "a25.jpg",
              finalWish: "H√£y m·∫°nh d·∫°n theo ƒëu·ªïi ƒëam m√™, v√¨ Thu√Ω Anh x·ª©ng ƒë√°ng v·ªõi nh·ªØng ƒëi·ªÅu tuy·ªát v·ªùi nh·∫•t."
            },
            { wish: "H√£y lu√¥n gi·ªØ n·ª• c∆∞·ªùi h·ªìn nhi√™n n√†y tr√™n m√¥i nh√©! üòä", img: "a23.jpg",
              finalWish: "B·ªüi n·ª• c∆∞·ªùi c·ªßa Thu√Ω Anh ch√≠nh l√† ƒëi·ªÅu l√†m th·∫ø gi·ªõi n√†y tr·ªü n√™n d·ªÖ th∆∞∆°ng h∆°n."
            },
            { wish: "Happy Birthday! M√£i xinh ƒë·∫πp v√† th√†nh c√¥ng nhen! ‚ù§Ô∏è", img: "a41.png",
              finalWish: "Ch√∫c m·ªôt bu·ªïi sinh nh·∫≠t th·∫≠t r·ª±c r·ª°, ƒë·∫ßy k·ª∑ ni·ªám ƒë√°ng nh·ªõ v√† th·∫≠t nhi·ªÅu ni·ªÅm vui!"
            }
        ];

        // ========= New Year screen =========
        function startNewYearTypewriter() {
            const title = document.querySelector('.ny-title');
            const text = document.querySelector('.ny-text');
            const titleText = 'üéÜ Ch√∫c M·ª´ng NƒÉm M·ªõi 2026 üéÜ';

            const textContent =
`Nh√¢n d·ªãp nƒÉm m·ªõi, ch√∫c Thu√Ω Anh c√πng gia ƒë√¨nh v√† nh·ªØng ng∆∞·ªùi th√¢n y√™u m·ªôt nƒÉm m·ªõi

An Khang Th·ªãnh V∆∞·ª£ng - V·∫°n S·ª± Nh∆∞ √ù - T·ª∑ S·ª± Nh∆∞ M∆°

S·ª©c Kh·ªèe D·ªìi D√†o - C√¥ng Vi·ªác Thu·∫≠n L·ª£i - Gia ƒê√¨nh H∆∞ng Th·ªãnh

Gia ƒê√¨nh Lu√¥n ·∫§m √Åp - H·∫°nh Ph√∫c - Tr√†n Ng·∫≠p Ti·∫øng C∆∞·ªùi v√† Nhi·ªÅu ƒêi·ªÅu May M·∫Øn

Mong nƒÉm m·ªõi s·∫Ω mang ƒë·∫øn th·∫≠t nhi·ªÅu ni·ªÅm vui v√† nh·ªØng kh·ªüi ƒë·∫ßu t·ªët ƒë·∫πp cho t·∫•t c·∫£ m·ªçi ng∆∞·ªùi.
Ch√∫c Thu√Ω Anh lu√¥n gi·ªØ ƒë∆∞·ª£c tinh th·∫ßn t√≠ch c·ª±c, c√¥ng vi·ªác thu·∫≠n l·ª£i v√† cu·ªôc s·ªëng ng√†y c√†ng vi√™n m√£n.
Mong nƒÉm m·ªõi s·∫Ω mang ƒë·∫øn th·∫≠t nhi·ªÅu ni·ªÅm vui v√† nh·ªØng kh·ªüi ƒë·∫ßu t·ªët ƒë·∫πp cho Thu√Ω Anh c√πng v·ªõi Gia ƒê√¨nhüå∏`;

            typeWriter(title, titleText, 80, () => typeWriter(text, textContent, isMobile ? 28 : 40));
        }

        function showNewYearScreen() {
            const ny = document.getElementById('screen-newyear');
            if (!ny) return;

            ny.style.display = "flex";
            ny.style.opacity = "1";

            // reset
            const title = document.querySelector('.ny-title');
            const text = document.querySelector('.ny-text');
            if (title) title.innerHTML = '';
            if (text) text.innerHTML = '';

            setTimeout(startNewYearTypewriter, 400);

            const endNY = Date.now() + (isMobile ? 7000 : 10000);
            (function frameNY() {
                confetti({
                    particleCount: isMobile ? 6 : 8,
                    spread: 360,
                    startVelocity: 45,
                    colors: ['#ffd700', '#ff4757', '#ffffff'],
                    origin: { x: Math.random(), y: Math.random() * 0.4 },
                    zIndex: 100001
                });
                if (Date.now() < endNY) requestAnimationFrame(frameNY);
            })();
        }

        // ========= Thank you screen =========
        function startThankYouTypewriter() {
            const title = document.querySelector('.thankyou-title');
            const text = document.querySelector('.thankyou-text');
            const emojis = document.querySelector('.thankyou-emojis');
            if (!title || !text || !emojis) return;

            emojis.style.opacity = '0';
            const titleText = 'C·∫£m ∆°n b·∫°n ƒë√£ d√†nh th·ªùi gian ƒë·ªÉ xem h·∫øt! ‚ù§Ô∏è';
            const textContent = 'Hy v·ªçng b·∫°n ƒë√£ c√≥ nh·ªØng kho·∫£nh kh·∫Øc vui v·∫ª v√† ·∫•m √°p. Ch√∫c b·∫°n m·ªôt ng√†y tuy·ªát v·ªùi!';

            typeWriter(title, titleText, 70, () => {
                typeWriter(text, textContent, isMobile ? 30 : 45, () => {
                    emojis.style.opacity = '1';
                    startThankYouFireworks();
                });
            });
        }

        function startThankYouFireworks() {
            const endThankYou = Date.now() + (isMobile ? 9000 : 15000);

            (function frame() {
                const burstCount = isMobile ? 1 : (Math.random() * 3 + 1);
                for (let i = 0; i < burstCount; i++) {
                    setTimeout(() => {
                        confetti({
                            particleCount: (isMobile ? 18 : 25) + Math.random() * (isMobile ? 14 : 25),
                            angle: 90,
                            spread: 140,
                            startVelocity: isMobile ? 55 : 75,
                            colors: ['#ffd700', '#ff4757', '#ffffff', '#ff6b81', '#ffa502', '#ffff00', '#ff1493', '#00ff00'],
                            origin: { x: Math.random() * 0.8 + 0.1, y: 1 },
                            zIndex: 100002,
                            gravity: 0.65,
                            scalar: isMobile ? 1.1 : 1.5,
                            drift: Math.random() * 1 - 0.5,
                            ticks: 260 + Math.random() * 160
                        });
                    }, i * (isMobile ? 260 : 200));
                }
                if (Date.now() < endThankYou) requestAnimationFrame(frame);
            })();
        }

        // ========= Photo click wishes =========
        function shootCornerFireworks(ms) {
            const end = Date.now() + ms;
            (function frame() {
                confetti({
                    particleCount: isMobile ? 5 : 7,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0, y: 0.8 },
                    colors: ['#ff4757', '#ffd700', '#ffffff'],
                    zIndex: 999999
                });
                confetti({
                    particleCount: isMobile ? 5 : 7,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1, y: 0.8 },
                    colors: ['#ff4757', '#ffd700', '#ffffff'],
                    zIndex: 999999
                });
                if (Date.now() < end) requestAnimationFrame(frame);
            })();
        }

        // ========= Start flow =========
        function startCounter() {
            document.getElementById('screen-intro').style.display = "none";
            document.getElementById('screen-counter').style.display = "flex";

            $$('.sparkler-head').forEach(h => h.classList.add('sparkler-burning'));

            const sparkInterval = setInterval(() => {
                createSparkles('stick-1');
                createSparkles('stick-2');
            }, isMobile ? 90 : 60);
            // code ƒë·ªët ch√°y ph√°o hoa
            let count = 6;
            const digitEl = document.getElementById('digit');
            digitEl.innerText = count;

            const timer = setInterval(() => {
                count--;
                digitEl.innerText = count;
                digitEl.style.transform = "scale(1.4)";
                const color = `hsl(${Math.max(count,0) * 18}, 100%, 65%)`;
                digitEl.style.textShadow = `0 0 20px ${color}, 0 0 40px ${color}, 0 0 60px ${color}`;
                setTimeout(() => { digitEl.style.transform = "scale(1)"; }, 200);

                if (count <= 0) {
                    clearInterval(timer);
                    clearInterval(sparkInterval);
                    showFinal();
                }
            }, 1000);
        }

        function showFinal() {
            document.getElementById('screen-counter').style.display = "none";
            const hbContainer = document.getElementById('hb-container');
            hbContainer.style.opacity = "1";
            hbContainer.style.display = "flex";

            // Stop upward fireworks while reading the message (avoid distraction + mobile lag)
            stopUpwardFireworks();

            const textContainer = document.getElementById('typewriter-text');
            const fullText = "Ng√†y TA ra ƒë·ªùi l√† m·ªôt ng√†y r·∫•t ƒë·∫∑c bi·ªát v·ªõi Gƒê TA, c√≤n v·ªõi Tui th√¨ ƒë∆°n gi·∫£n l√† c√≥ th√™m 1 ng∆∞·ªùi b·∫°n ƒë√°ng y√™u, d·ªÖ th∆∞∆°ng. TA ch√†o ƒë·ªùi c√°ch T·∫øt v√†i ng√†y, nh∆∞ mang theo b·∫ßu kh√¥ng kh√≠ sum v·∫ßy, ni·ªÅm vui v√† h√†nh ph√∫c ƒë·∫ßu nƒÉm ƒë·∫øn s·ªõm cho c·∫£ nh√†. V·ªõi Gƒê, TA m√£i l√† c√¥ n√†ng c√¥ng ch√∫a b√© nh·ªè, ƒë√°ng y√™u nh·∫•t trong nh√†. Ch√∫c TA lu√¥n m·∫°nh kh·ªèe, b√¨nh an, s·ªõm t√¨m ƒë∆∞·ª£c 1 t√¨nh y√™u ch√¢n th√†nh ƒë·ªÉ ƒë∆∞·ª£c y√™u th∆∞∆°ng, chi·ªÅu chu·ªông. C√¥ng vi·ªác th√¨ lu√¥n su√¥n s·∫ª, g·∫∑p ƒë√∫ng ng∆∞·ªùi, ƒë√∫ng c∆° h·ªôi, l√†m ƒëi·ªÅu m√¨nh th√≠ch c·∫£m th·∫•y x·ª©ng ƒë√°ng.";
            typeWriter(textContainer, fullText, isMobile ? 45 : 100);

            const canvas = document.createElement('canvas');
            canvas.style.position = 'fixed'; canvas.style.inset = '0';
            canvas.style.width = '100%'; canvas.style.height = '100%';
            canvas.style.zIndex = '100000'; canvas.style.pointerEvents = 'none';
            document.body.appendChild(canvas);

            const myConfetti = confetti.create(canvas, { resize: true });
            const end = Date.now() + 20000;
            const colors = ['#ff69b4', '#ff1493', '#ffd700', '#ffffff', '#ff4757'];

            (function frame() {
                myConfetti({ particleCount: isMobile ? 6 : 8, angle: 60, spread: 70, origin: { x: 0, y: 0.8 }, colors, scalar: 1.2 });
                myConfetti({ particleCount: isMobile ? 6 : 8, angle: 120, spread: 70, origin: { x: 1, y: 0.8 }, colors, scalar: 1.2 });
                if (Date.now() < end) requestAnimationFrame(frame);
                else canvas.remove();
            })();

            setTimeout(() => {
                hbContainer.style.opacity = "0";
                setTimeout(() => {
                    hbContainer.style.display = "none";
                    document.getElementById('screen-main').style.display = "block";
                    initBalloons();
                    startFallingPhotos();
                    startUpwardFireworks();

                    setTimeout(() => {
                        const goNY = document.getElementById('go-newyear');
                        if (goNY) goNY.style.opacity = "1";
                    }, 15000);
                }, 900);
            }, isMobile ? 65000 : 65000);
        }

        // ========= Events =========
        document.addEventListener('DOMContentLoaded', () => {
            initIntroBalloons();
            initOrbitFlowers();
            createPetals();
            createMagicDust();
            startContinuousConfetti();
            startUpwardFireworks();

            // clear NY/ThankYou placeholders
            const nyTitle = document.querySelector('.ny-title');
            const nyText = document.querySelector('.ny-text');
            if (nyTitle) nyTitle.innerHTML = '';
            if (nyText) nyText.innerHTML = '';
            const tyTitle = document.querySelector('.thankyou-title');
            const tyText = document.querySelector('.thankyou-text');
            if (tyTitle) tyTitle.innerHTML = '';
            if (tyText) tyText.innerHTML = '';

            // global click for music
            document.addEventListener('click', handleGlobalClick);

            // Start button
            const startBtn = document.getElementById('start-btn');
            if (startBtn) startBtn.onclick = () => {
                handleGlobalClick();
                startCounter();
            };

            // Go to New Year (need 6 wishes)
            const goNY = document.getElementById('go-newyear');
            if (goNY) {
                goNY.onclick = () => {
                    if (clickedPhotos.size < TOTAL_PHOTOS_REQUIRED) {
                        Swal.fire({
                            icon: 'warning',
                            title: 'Ch∆∞a ƒë·ªß l·ªùi ch√∫c üò¢',
                            text: 'B·∫°n h√£y xem v√† thu nh·∫≠p ƒë·ªß 6 l·ªùi ch√∫c tr∆∞·ªõc khi m·ªü m√≥n qu√† ti·∫øp theo nh√©!',
                            confirmButtonText: 'OK üíù',
                            confirmButtonColor: '#ff4757'
                        });
                        return;
                    }

                    const main = document.getElementById('screen-main');
                    main.style.opacity = "0";
                    setTimeout(() => {
                        main.style.display = "none";
                        showNewYearScreen();
                    }, 800);
                };
            }

            // NY continue -> Thank you
            const btnToMain = document.getElementById('btn-to-main');
            if (btnToMain) {
                btnToMain.onclick = () => {
                    const ny = document.getElementById('screen-newyear');
                    ny.style.display = "none";
                    const ty = document.getElementById('screen-thankyou');
                    ty.style.display = "flex";
                    startThankYouTypewriter();
                };
            }

            // Photo clicks
            document.querySelectorAll('.avatar__img').forEach((imgEl, index) => {
                imgEl.onclick = () => {
                    clickedPhotos.add(index);

                    if (clickedPhotos.size === TOTAL_PHOTOS_REQUIRED && typeof Swal !== 'undefined') {
                        Swal.fire({
                            icon: 'success',
                            title: 'Ho√†n th√†nh üéâ',
                            text: 'B·∫°n ƒë√£ thu nh·∫≠p ƒë·ªß 6 l·ªùi ch√∫c m·ª´ng! H√£y b·∫•m ti·∫øp ƒë·ªÉ xem b·∫•t ng·ªù cu·ªëi üíñ',
                            confirmButtonText: 'Tuy·ªát v·ªùi ‚ú®',
                            confirmButtonColor: '#ffd700'
                        });
                    }

                    const data = birthdayData[index];
                    shootCornerFireworks(900);

                    Swal.fire({
                        html: `
                            <div style="text-align: center; padding: 10px;">
                                <div class="invitation-header">Special Invitation</div>
                                <img src="${imgEl.src}" class="swal-img-polaroid" style="width: 200px; height: 200px; object-fit: cover;">
                                <h2 style="color: #b8860b; font-family: 'Dancing Script'; font-size: 2.2rem; margin: 10px 0;">Th√∫y Anh</h2>
                                <p style="font-style: italic; color: #555;">"${data.wish}"</p>
                                <span class="click-hint">‚ú¶ Ch·∫°m "M·ªü Qu√†" ƒë·ªÉ nh·∫≠n ƒëi·ªÅu k·ª≥ di·ªáu ‚ú¶</span>
                            </div>
                        `,
                        width: '420px',
                        background: '#fffaf0',
                        confirmButtonText: 'M·ªü Qu√† ‚ú®',
                        confirmButtonColor: '#b8860b',
                        allowOutsideClick: false,
                        allowEscapeKey: false,
                        showCloseButton: false,
                        customClass: { popup: 'invitation-card-custom' }
                    }).then((result) => {
                        if (!result.isConfirmed) return;

                        const overlay = document.createElement('div');
                        overlay.style.cssText = `
                            position: fixed; inset: 0;
                            background: radial-gradient(circle, #2c0000 0%, #000 100%);
                            z-index: 999999; display: flex; flex-direction: column;
                            justify-content: center; align-items: center;
                            opacity: 0; transition: opacity 1.2s;
                        `;
                        document.body.appendChild(overlay);

                        const messageBox = document.createElement('div');
                        messageBox.className = 'soft-glow-text';
                        messageBox.innerHTML = `
                            <h1 style="font-size: clamp(2rem, 7vw, 3rem); margin-bottom: 15px;">Th√∫y Anh ∆°i...</h1>
                            <p style="font-size: clamp(1rem, 3.8vw, 1.6rem); width: 85%; margin: 0 auto; font-family: 'Montserrat';">
                                ${data.finalWish || "Ch√∫c b·∫°n lu√¥n h·∫°nh ph√∫c!"}
                            </p>
                        `;
                        overlay.appendChild(messageBox);

                        const heartCanvas = document.createElement('canvas');
                        heartCanvas.style.cssText = 'position: fixed; inset: 0; z-index: 1000001; pointer-events: none;';
                        document.body.appendChild(heartCanvas);
                        const ctx = heartCanvas.getContext('2d');
                        function resizeHeartCanvas() {
                            heartCanvas.width = window.innerWidth;
                            heartCanvas.height = window.innerHeight;
                        }
                        resizeHeartCanvas();
                        window.addEventListener('resize', resizeHeartCanvas, { passive: true });

                        function getHeartPoint(t) {
                            const x = 16 * Math.pow(Math.sin(t), 3);
                            const y = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
                            const scale = isMobile ? 12 : 15;
                            return { x: x * scale, y: -y * scale };
                        }

                        const outlineColors = ['#ff4757', '#ffa502', '#2ed573', '#1e90ff', '#3742fa', '#ff6b81'];
                        let tTime = 0;
                        let drawProgress = 0;

                        function animateHeart() {
                            tTime += 0.01;
                            ctx.clearRect(0, 0, heartCanvas.width, heartCanvas.height);

                            const pulse = 1 + 0.3 * Math.sin(tTime * 2);
                            const outlineColor = outlineColors[index] || 'gold';

                            ctx.strokeStyle = outlineColor;
                            ctx.lineWidth = (isMobile ? 6 : 8) * pulse;
                            ctx.shadowBlur = (isMobile ? 18 : 25) * pulse;
                            ctx.shadowColor = outlineColor;
                            ctx.lineCap = 'round';
                            ctx.lineJoin = 'round';

                            ctx.beginPath();
                            const steps = 200;
                            const maxStep = Math.floor(drawProgress * steps);
                            for (let i = 0; i <= maxStep; i++) {
                                const t = (i / steps) * Math.PI * 2;
                                const pt = getHeartPoint(t);
                                const x = heartCanvas.width / 2 + pt.x;
                                const y = heartCanvas.height / 2 + pt.y;
                                if (i === 0) ctx.moveTo(x, y);
                                else ctx.lineTo(x, y);
                            }
                            ctx.stroke();

                            if (drawProgress > 0) {
                                const particleCount = Math.floor(drawProgress * (isMobile ? 40 : 80));
                                for (let i = 0; i < particleCount; i++) {
                                    const t = (i / Math.max(particleCount, 1)) * Math.PI * 2;
                                    const pt = getHeartPoint(t);
                                    const x = heartCanvas.width / 2 + pt.x + (Math.random() - 0.5) * 12;
                                    const y = heartCanvas.height / 2 + pt.y + (Math.random() - 0.5) * 12;

                                    const hue = (tTime * 50 + i * 10) % 360;
                                    ctx.fillStyle = `hsl(${hue}, 100%, 70%)`;
                                    ctx.shadowBlur = 10;
                                    ctx.shadowColor = `hsl(${hue}, 100%, 70%)`;

                                    ctx.beginPath();
                                    ctx.arc(x, y, 2.5 + Math.random() * 3, 0, Math.PI * 2);
                                    ctx.fill();
                                }
                            }

                            if (drawProgress < 1) drawProgress += isMobile ? 0.0016 : 0.001;
                            if (overlay.parentNode) requestAnimationFrame(animateHeart);
                        }

                        function startFloatingPhotos() {
                            let pIdx = 0;
                            const max = isMobile ? 24 : 50;
                            const interval = setInterval(() => {
                                if (pIdx > max) { clearInterval(interval); return; }
                                const img = document.createElement('img');
                                img.src = photoSourcesAll[pIdx % photoSourcesAll.length];
                                img.className = 'floating-photo-surprise';
                                img.style.left = Math.random() * 80 + 10 + "vw";
                                img.style.top = "100vh";
                                document.body.appendChild(img);
                                pIdx++;
                                setTimeout(() => img.remove(), 8000);
                            }, isMobile ? 1500 : 1200);
                        }

                        setTimeout(() => {
                            overlay.style.opacity = "1";
                            animateHeart();
                            startFloatingPhotos();
                        }, 100);

                        setTimeout(() => {
                            const closeTip = document.createElement('div');
                            closeTip.innerText = "Ch·∫°m ƒë·ªÉ quay l·∫°i ‚ù§Ô∏è";
                            closeTip.style.cssText = "position:fixed; bottom:8%; color:rgba(255,255,255,0.7); z-index:1000010; font-family:Montserrat; font-size:0.9rem;";
                            overlay.appendChild(closeTip);
                            overlay.style.cursor = "pointer";
                            overlay.onclick = () => {
                                overlay.style.opacity = "0";
                                setTimeout(() => {
                                    overlay.remove();
                                    heartCanvas.remove();
                                    window.removeEventListener('resize', resizeHeartCanvas);
                                }, 1200);
                            };
                        }, 900);
                    });
                };
            });
        });
    </script>
</body>
</html>
